
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction to Constant Memory &#8212; A Functional Introduction to MATLAB x CUDA</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapters/IntroductionToConstantMemory';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Introduction To Dynamic Parallelism" href="IntroductionToDynamicParallelism.html" />
    <link rel="prev" title="Introduction to Shared Memory" href="IntroductionToSharedMemory.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/matlabxcudalogo.png" class="logo__image only-light" alt="A Functional Introduction to MATLAB x CUDA - Home"/>
    <script>document.write(`<img src="../_static/matlabxcudalogo.png" class="logo__image only-dark" alt="A Functional Introduction to MATLAB x CUDA - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    An Introduction to Matlab x CUDA
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="AboutMatlab.html">About MATLAB</a></li>
<li class="toctree-l1"><a class="reference internal" href="AboutCuda.html">About CUDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="SkeletalMex.html">The Skeletal Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="CUDAMemoryModel.html">CUDA Memory Model</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="BasicMexExamples.html">Basic Mex Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Sections/HelloWorld.html">Hello World</a></li>

<li class="toctree-l2"><a class="reference internal" href="Sections/CalculatingRowMean.html">Calculating Row Mean</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/FillingAnMxArray.html">Filling an mxArray</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/MultiplyingRowMatrixWithScalar.html">Multiplying a row-matrix with a scalar</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/ElementWiseMultiplyingTwo2DMatrices.html">Element-wise multiplying two 2D-matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/MatrixMultiplication.html">Matrix Multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/AXPY.html">AXPY Implementation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="IntroductionToSharedMemory.html">Introduction to Shared Memory</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Introduction to Constant Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="IntroductionToDynamicParallelism.html">Introduction To Dynamic Parallelism</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="ImageProcessing.html">Image Processing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Sections/ImageUpsampling.html">Upsampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/ImageDownsampling.html">Downsampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/ImageDecimation.html">Decimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/ImageInterpolation.html">Interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/Image_RGB2YCbCr.html">RGB to YCbCr</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/Image_YCbCr2RGB.html">YCbCr to RGB</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="DigitalSignalProcessing.html">Digital Signal Processing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Sections/DSP_Convolution.html">Standard Convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/DSP_Downsampling.html">Signal Downsampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/DSP_Upsampling.html">Signal Upsampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/DSP_Decimation.html">Decimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/DSP_Interpolation.html">Interpolation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Beamforming.html">Beamforming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Sections/Beamforming_FrequencyDomainBeamforming.html">Frequency Domain Beamforming</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sections/Beamforming_WindowedFrequencyDomainBeamforming.html">Frequency Domain Beamforming with Sensor-Weighing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="ComputationalImaging.html">Computational Imaging</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/vrsreeganesh/MatlabxCUDA" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/vrsreeganesh/MatlabxCUDA/issues/new?title=Issue%20on%20page%20%2FChapters/IntroductionToConstantMemory.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Chapters/IntroductionToConstantMemory.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Introduction to Constant Memory</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stencil-operation">Stencil Operation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constant-memory">Constant Memory</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-constant-memory-complete-but-not-polished">Using Constant-Memory (complete but  not polished)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mexcuda-code-complete-but-not-polished">MexCUDA Code(complete but not polished)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-complete-but-not-polished">Kernel (complete but not polished)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gateway-function">Gateway function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matlab-code-complete-but-not-polished">Matlab Code (complete but not polished)</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="introduction-to-constant-memory">
<h1>Introduction to Constant Memory<a class="headerlink" href="#introduction-to-constant-memory" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>In this chapter, we introduce constant-memory and how to use it through a very simple example. <em>Constant Memory</em> is another class of memory that is available in most NVIDIA GPUs. Using constant-memory to store data that is highly fetched, won’t be edited and not-too-large for cache results in highly improved performance due to the reduced data-fetch times from the SMs. This chapter presents how to use constant-memory generally and demonstrate how to use constant-memory through an example.</p>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<section id="stencil-operation">
<h3>Stencil Operation<a class="headerlink" href="#stencil-operation" title="Link to this heading">#</a></h3>
<p>A stencil operation is a computational technique used in multiple fields like image and signal processing. It involves applying a function or operation to a neighborhood of data points around a central point in a grid or an array. The output of this operation produces values at each point which is a function of  the elements in its neighborhood.</p>
<p>The following are the key-aspects of a stencil operation</p>
<ul class="simple">
<li><p><strong>Neighborhood</strong>: The stencil defines a pattern or shape around each point in the grid that forms the neighborhood of that point for this operation. The elements of this neighborhood are used to compute the results that will be stored in the output index corresponding to the input center index. Common stencils for images include 3x3, 5x5 or more complex shapes. Note that the dimensions are usually odd-dimensions along each arrays so that there is a “center element”.</p></li>
<li><p><strong>Computation</strong>: At each grid point, the operation combines the values of the neighboring points according to the stencil’s rules. Basic stencil operations are averaging, summing, max-ing, or more complex functions.</p></li>
<li><p><strong>Applications</strong>: Following are three different fields where this is used</p>
<ul>
<li><p><strong>Numerical Methods</strong>: In solving partial differential equations (PDEs), stencil operations are used to approximate derivatives and other operations.</p></li>
<li><p><strong>Image Processing</strong>: Stencils are applied for tasks like edge detection, blurring, and sharpening, where each pixel’s new value depends on the values of its neighboring pixels.</p></li>
<li><p><strong>Scientific Computing</strong>: Stencil operations are common in simulations, such as fluid dynamics, where they model the interaction between points in a grid.
Stencil operations are highly parallelizable, making them well-suited for implementation on GPUs using CUDA.</p></li>
</ul>
</li>
</ul>
</section>
<section id="constant-memory">
<h3>Constant Memory<a class="headerlink" href="#constant-memory" title="Link to this heading">#</a></h3>
<p><em>Constant Memory</em> is another class of memory that is available in most NVIDIA GPUs. The constant memory is at the same distance from the SM as that of the Global Memory. Though constant memory is not at the same proximity as that of shared-memory, it is aggressively cached. This means that using constant memory to store data that will remain constant throughout the process in addition to being regularly used will produce gains in speed. Thus this kind of data that is stored in the constant memory is efficiently and effectively cached. This kind of aggressive caching allows for extreme streamlining and large gains in time due to the high hit rates in the cache.</p>
<p>Regarding access-privilege, the data in Constant Memory is only allowed to be set from the host-side and never from the device-side. That is, host side write access while device-side has read access. Due to these technical designs and characteristics, Constant Memory must be used to store those values that are</p>
<ul class="simple">
<li><p>Regularly Used</p></li>
<li><p>No edits</p></li>
<li><p>Not too large</p></li>
</ul>
<p>Thus, for tasks such as convolution where we use the same kernel throughout the data, using constant-memory to store the kernel-weights is a good idea. Even though most filters will fit just fine into constant-memory of constant sizes, it is important to remember that the improvement in performance stems from the high-hit rate of increasing the probability of finding them in the cache associated with the constant-memory.</p>
<section id="using-constant-memory-complete-but-not-polished">
<h4>Using Constant-Memory (complete but  not polished)<a class="headerlink" href="#using-constant-memory-complete-but-not-polished" title="Link to this heading">#</a></h4>
<p>Unlike Shared Memory, <em>Constant Memory</em> doesn’t give us the option to be dynamically allocated. Thus, we allocate constant memory during compile time, through preprocessor directives. Constant memory is declared in the same way we declare a global variable, but with the addition that we use the identifier, <span class="math notranslate nohighlight">\(\_\_constant\_\_\)</span>. Once declared, we populate constant-memory using the function, <em>cudaMemcpyToSymbol()</em>. Following is a skeletal code that demonstrates using constant memory.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="c1">// How to Declare Constant Memory </span>
<span class="cp">#define CONSTANT_MEMORY_LENGTH 21</span>
<span class="n">__constant__</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">constantFilterKernel</span><span class="p">[</span><span class="n">CONSTANT_MEMORY_LENGTH</span><span class="p">];</span>

<span class="c1">// gate-way function</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">mexFunction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nlhs</span><span class="p">,</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">plhs</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nrhs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">prhs</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">	</span><span class="p">...</span>
<span class="w">	</span>
<span class="w">	</span><span class="c1">// sending data from Host to Constant Memory</span>
<span class="w">    </span><span class="n">cudaMemcpyToSymbol</span><span class="p">(</span><span class="n">constantFilterKernel</span><span class="p">,</span>
<span class="w">                       </span><span class="n">hostFilterKernel</span><span class="p">,</span>
<span class="w">                       </span><span class="n">numElementsKernel</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="w">	</span><span class="p">...</span>
<span class="p">}</span>

<span class="p">...</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="mexcuda-code-complete-but-not-polished">
<h2>MexCUDA Code(complete but not polished)<a class="headerlink" href="#mexcuda-code-complete-but-not-polished" title="Link to this heading">#</a></h2>
<p>We start by declaring constant memory. The following lines of code shows the use of preprocessor directives to choose the size of the constant-memory.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// setting up constant memory</span>
<span class="cp">#define CONSTANT_MEMORY_LENGTH 21</span>
<span class="n">__constant__</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">constantFilterKernel</span><span class="p">[</span><span class="n">CONSTANT_MEMORY_LENGTH</span><span class="p">];</span>
</pre></div>
</div>
<section id="kernel-complete-but-not-polished">
<h3>Kernel (complete but not polished)<a class="headerlink" href="#kernel-complete-but-not-polished" title="Link to this heading">#</a></h3>
<p>In the kernel, we start by obtaining the mapping from the thread-address to the data-index that the particular thread is responsible for. For this particular example, we’re mapping the thread-address to the data-index that the thread will be responsible for. The mapping to the thread-address to the output-index is done in the following manner.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// mapping from thread-address to output-address</span>
<span class="kt">size_t</span><span class="w"> </span><span class="n">tid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="n">blockDim</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</pre></div>
</div>
<p>Note that the stencil operation is different from that of convolution. In the sense that the stencil operation is done in such a way that the stencil is always inside the input array. This means that the output index will always be less than the length of the input array since the output will be of the same length. Thus, the gating is as follows</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// ensuring validity</span>
<span class="k">if</span><span class="p">(</span><span class="n">tid</span><span class="o">&lt;</span><span class="n">inputDimensionsA</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Before we perform the operation, we setup the variables that will be used for the operation in the following manner.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// ensuring validity</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tid</span><span class="o">&lt;</span><span class="n">inputDimensionsA</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// performing the kernel operation</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">accusum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bigIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">kernelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">        </span><span class="p">...</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Unlike convolution, the output is stored to the position of the middle-index in the output array. So keeping this in mind, we calculate the dot product of the two sub-arrays in the following manner.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// ensuring validity</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tid</span><span class="o">&lt;</span><span class="n">inputDimensionsA</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="p">...</span>

<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="o">*</span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">inputDimensionsB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">inputDimensionsB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// obtaining the absolute indices into each datastructures</span>
<span class="w">            </span><span class="n">bigIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span>
<span class="w">            </span><span class="n">kernelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">inputDimensionsB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// checking for boundary conditions</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">bigIndex</span><span class="o">&gt;=</span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">bigIndex</span><span class="o">&lt;</span><span class="w"> </span><span class="n">inputDimensionsA</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">accusum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accusum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">dA</span><span class="p">[</span><span class="n">bigIndex</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">constantFilterKernel</span><span class="p">[</span><span class="n">kernelIndex</span><span class="p">];</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="p">...</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Once the results have been computed, we store it to the output in the following manner.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// ensuring validity</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tid</span><span class="o">&lt;</span><span class="n">inputDimensionsA</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="p">...</span>

<span class="w">        </span><span class="c1">// adding the value to the final result</span>
<span class="w">        </span><span class="n">dC</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">accusum</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Putting it together, we get the following</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// global kernel</span>
<span class="n">__global__</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Stencil_ConstantMemory</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">dA</span><span class="p">,</span>
<span class="w">                                            </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">dC</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                            </span><span class="n">mwSize</span><span class="w"> </span><span class="o">*</span><span class="n">inputDimensionsA</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                            </span><span class="n">mwSize</span><span class="w"> </span><span class="o">*</span><span class="n">inputDimensionsB</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// addresses</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">tid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="n">blockDim</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// ensuring validity</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tid</span><span class="o">&lt;</span><span class="n">inputDimensionsA</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// performing the kernel operation</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">accusum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bigIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">kernelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="o">*</span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">inputDimensionsB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">inputDimensionsB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// obtaining the absolute indices into each datastructures</span>
<span class="w">            </span><span class="n">bigIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span>
<span class="w">            </span><span class="n">kernelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">inputDimensionsB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// checking for boundary conditions</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">bigIndex</span><span class="o">&gt;=</span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">bigIndex</span><span class="o">&lt;</span><span class="w"> </span><span class="n">inputDimensionsA</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">accusum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accusum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">dA</span><span class="p">[</span><span class="n">bigIndex</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">constantFilterKernel</span><span class="p">[</span><span class="n">kernelIndex</span><span class="p">];</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// adding the value to the final result</span>
<span class="w">        </span><span class="n">dC</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">accusum</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="gateway-function">
<h3>Gateway function<a class="headerlink" href="#gateway-function" title="Link to this heading">#</a></h3>
<p>In the gateway function, we first check the number of inputs provided, the number of outputs expected, the data-type and the dimensionality in the following manner.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// gateway function</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">mexFunction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nlhs</span><span class="p">,</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">plhs</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nrhs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">prhs</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// checking number of inputs</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">nrhs</span><span class="o">!=</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">mexErrMsgTxt</span><span class="p">(</span><span class="s">&quot;Number of Inputs are Wrong </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// checking number of outputs</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">nlhs</span><span class="o">!=</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">mexErrMsgTxt</span><span class="p">(</span><span class="s">&quot;Number of Outputs are Wrong </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// checking input data types</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">mxIsDouble</span><span class="p">(</span><span class="n">prhs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">mxIsDouble</span><span class="p">(</span><span class="n">prhs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">mexErrMsgTxt</span><span class="p">(</span><span class="s">&quot;One of the Inputs are of the wrong data-type </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">...</span>
<span class="p">}</span><span class="w">    </span>
</pre></div>
</div>
<p>Once the checking is complete, we fetch the inputs, store it into the objects of the class, <em>CustomGPUObject</em> and send it to the device global memory in the following manner.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// gateway function</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">mexFunction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nlhs</span><span class="p">,</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">plhs</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nrhs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">prhs</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">...</span>

<span class="w">    </span><span class="c1">// Fetching inputs and sending to device global memory</span>
<span class="w">    </span><span class="n">CustomGPUObject</span><span class="w"> </span><span class="n">inputA</span><span class="p">(</span><span class="n">prhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">    </span><span class="n">CustomGPUObject</span><span class="w"> </span><span class="n">inputB</span><span class="p">(</span><span class="n">prhs</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="w">    </span><span class="c1">// Sending inputs to device global memory</span>
<span class="w">    </span><span class="n">inputA</span><span class="p">.</span><span class="n">copyFromHostToDevice</span><span class="p">();</span>
<span class="w">    </span><span class="n">inputB</span><span class="p">.</span><span class="n">copyFromHostToDevice</span><span class="p">();</span>

<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, we populate the contents of the shared-memory with the stencil weights. This step is done in the following manner.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// sending input filter to constant memory</span>
<span class="n">cudaMemcpyToSymbol</span><span class="p">(</span><span class="n">constantFilterKernel</span><span class="p">,</span>
<span class="w">                    </span><span class="n">inputB</span><span class="p">.</span><span class="n">inputPointer_real</span><span class="p">,</span>
<span class="w">                    </span><span class="n">inputB</span><span class="p">.</span><span class="n">numElements</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
</pre></div>
</div>
<p>Next, we create a matlab matrix to store the output. This particular object is then encapsulated using an object of the class, <em>CustomGPUObject</em>. The contents of this class is then made available in the global device memory using the class method, <em>copyFromHostToDevice</em>. This is done in the following manner.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// gateway function</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">mexFunction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nlhs</span><span class="p">,</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">plhs</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nrhs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">prhs</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">...</span>

<span class="w">    </span><span class="c1">// setting  up output</span>
<span class="w">    </span><span class="n">plhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mxCreateNumericMatrix</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                    </span><span class="n">inputA</span><span class="p">.</span><span class="n">numElements</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                    </span><span class="n">mxDOUBLE_CLASS</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                    </span><span class="n">mxREAL</span><span class="p">);</span>
<span class="w">    </span><span class="n">CustomGPUObject</span><span class="w"> </span><span class="n">outputC</span><span class="p">(</span><span class="n">plhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">    </span><span class="n">outputC</span><span class="p">.</span><span class="n">copyFromHostToDevice</span><span class="p">();</span>
<span class="w">    </span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span><span class="w">   </span>
</pre></div>
</div>
<p>Once the constant memory has been populated and the rest of the inputs are available in the global memory, we perform the kernel launch in the following manner. First, we seup the launch configuration parameters: block-configuration and grid-configuration. That is followed by kernel launch in the following manner.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// gateway function</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">mexFunction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nlhs</span><span class="p">,</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">plhs</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nrhs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">prhs</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// prepping to call function </span>
<span class="w">    </span><span class="n">dim3</span><span class="w"> </span><span class="n">block</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">dim3</span><span class="w"> </span><span class="n">grid</span><span class="p">(</span><span class="n">inputA</span><span class="p">.</span><span class="n">numElements</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// calling function</span>
<span class="w">    </span><span class="n">Stencil_ConstantMemory</span><span class="o">&lt;&lt;&lt;</span><span class="n">grid</span><span class="p">,</span>
<span class="w">                             </span><span class="n">block</span><span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">inputA</span><span class="p">.</span><span class="n">d_inputPointer_real</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                      </span><span class="n">outputC</span><span class="p">.</span><span class="n">d_inputPointer_real</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                      </span><span class="n">inputA</span><span class="p">.</span><span class="n">d_inputDimensions</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                      </span><span class="n">inputB</span><span class="p">.</span><span class="n">d_inputDimensions</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once the outputs are computed by the kernel and made available in the device global memory, we copy the results back using the class method, <em>copyFromDeviceToHost</em>. This is followed by the usual commands to shut down the GPU.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// gateway function</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">mexFunction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nlhs</span><span class="p">,</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">plhs</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nrhs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">mxArray</span><span class="w"> </span><span class="o">*</span><span class="n">prhs</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">...</span>

<span class="w">    </span><span class="c1">// retrieving data from device to host</span>
<span class="w">    </span><span class="n">outputC</span><span class="p">.</span><span class="n">copyFromDeviceToHost</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// shutting down</span>
<span class="w">    </span><span class="n">cudaDeviceSynchronize</span><span class="p">();</span>
<span class="w">    </span><span class="n">cudaDeviceReset</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="matlab-code-complete-but-not-polished">
<h2>Matlab Code (complete but not polished)<a class="headerlink" href="#matlab-code-complete-but-not-polished" title="Link to this heading">#</a></h2>
<p>In the matlab section, we first start with compiling the cuda code in the following manner.</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="c">%% Basic Setup</span>
<span class="nb">clc</span><span class="p">;</span><span class="w"> </span><span class="nb">clear</span><span class="p">;</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="s">all</span><span class="p">;</span>

<span class="c">%% Compiling mex-cuda</span>
<span class="n">mexcuda</span><span class="w"> </span><span class="s">StencilConstantMemory_CUDA.cu</span>
</pre></div>
</div>
<p>We then prepare simple inputs for this particular example in the following manner.</p>
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% Preparing arguments</span>
<span class="n">inputArray</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
<span class="n">kernelArray</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">);</span>
</pre></div>
</div>
<p>Once the cuda code has been compiled (doesn’t need to be done each time) and the inputs have been prepared, we call the function and get the results in the following manner. We then plot the results.</p>
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% Calling function</span>
<span class="n">outputArray</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">StencilConstantMemory_CUDA</span><span class="p">(</span><span class="n">inputArray</span><span class="p">,</span><span class="w"> </span><span class="n">kernelArray</span><span class="p">);</span>

<span class="c">%% Plotting </span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="nb">plot</span><span class="p">(</span><span class="n">inputArray</span><span class="p">);</span><span class="w"> </span><span class="nb">title</span><span class="p">(</span><span class="s">&quot;inputArray&quot;</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="nb">plot</span><span class="p">(</span><span class="n">outputArray</span><span class="p">);</span><span class="w"> </span><span class="nb">title</span><span class="p">(</span><span class="s">&quot;outputArray&quot;</span><span class="p">);</span><span class="w">    </span>
</pre></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="IntroductionToSharedMemory.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction to Shared Memory</p>
      </div>
    </a>
    <a class="right-next"
       href="IntroductionToDynamicParallelism.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction To Dynamic Parallelism</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stencil-operation">Stencil Operation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constant-memory">Constant Memory</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-constant-memory-complete-but-not-polished">Using Constant-Memory (complete but  not polished)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mexcuda-code-complete-but-not-polished">MexCUDA Code(complete but not polished)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-complete-but-not-polished">Kernel (complete but not polished)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gateway-function">Gateway function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matlab-code-complete-but-not-polished">Matlab Code (complete but not polished)</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sreeganesh Valathara Rajendran
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>